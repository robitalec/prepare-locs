---
title: prepare-locs
output: 
  github_document:
    toc: true
---

---

A `targets` workflow for processing animal relocation data for the WEEL. 

```{r, eval = FALSE}
library(targets)
tar_visnetwork()
```

```{r viz, echo = FALSE}
library(targets)
suppressPackageStartupMessages(library(printr))
visNetwork::visNodes(tar_visnetwork(), size = 20, font=list(size=25))
```

# Input
```{r}
tar_read(meta)
```

# Output
## Files
```{r, eval = FALSE}
tar_read(exports)
```

```{r, echo = FALSE}
as.vector(tar_read(exports))
```

## Column names

| Column name | Description | 
| ----------- | ----------- | 
| id          | unique animal identifier | 
| datetime    | date time in UTC | 
| doy         | date of year, integer. see `data.table::yday()` | 
| mnth        | month, integer. see `data.table::month()` | 
| yr          | year, integer. see `data.table::year()` | 
| x_long      | longitude, EPSG code provided in `metadata()`. see `R/metadata.R` | 
| y_lat       | latitude, EPSG code provided in `metadata()`. see `R/metadata.R` |
| x_proj      | projected x coordinate, output EPSG code in `metadata()`. see `R/metadata.R` |  
| y_proj      | projected y coordinate, output EPSG code in `metadata()`. see `R/metadata.R` |  
| epsg_proj   | output EPSG of 'x_proj' and 'y_proj' as set in `metadata()`. |
| flag        | semi-colon separated flags indicating why locs are dropped and set to NaN | 
| [extracols] | Extras specified in `metadata()`. Eg. HERD. On output, column names are transformed to snake_case (eg. from 'HERD' to 'herd' or 'COLLAR ID' to 'collar_id')

## Flag counts
```{r,  1}
tar_read(checkflags)
```

# TODO

* 6030 not recognized by PROJ because it's not a complete CRS.. 


# Etc
Screening GPS fixes:

* https://ropensci.github.io/CoordinateCleaner/articles/Comparison_other_software.html
	+ missing coordinates
	+ lat == 0
	+ long == 0
	+ lat == long
	+ ...

* *Effects of habitat on GPS collar performance: using data screening to reduce location error*. Lewis et al. 2007
	+ drop 2D fixes
	+ threshold PDOP
	
* *Screening GPS telemetry data for locations having unacceptable error*. Laver et al. 





